{{ define "map"}}
<html>
<body> 
    div class="section">
    <h2>Location Tracking</h2>
    <div class="map-container">
        <script src="https://js.api.here.com/v3/3.1/mapsjs-core.js"></script>
        <script src="https://js.api.here.com/v3/3.1/mapsjs-service.js"></script>
        <script src="https://js.api.here.com/v3/3.1/mapsjs-ui.js"></script>
        <script src="https://js.api.here.com/v3/3.1/mapsjs-mapevents.js"></script>
        <link rel="stylesheet" href="https://js.api.here.com/v3/3.1/mapsjs-ui.css" />
        <script>
            function showCustomAlert(message) {
                // Create the alert element
                const alert = document.createElement('div');
                alert.className = 'custom-alert';
                alert.innerText = message;

                // Append it to the body
                document.body.appendChild(alert);

                // Show the alert
                setTimeout(() => {
                    alert.classList.add('show');
                }, 10);

                // Hide and remove the alert after 3 seconds
                setTimeout(() => {
                    alert.classList.remove('show');
                    setTimeout(() => alert.remove(), 300);
                }, 3000);
            }
            // Initialize HERE Platform
            const platform = new H.service.Platform({
                apikey: 'iYGPG2aN0ZDx6NBCHsBPsk10Pkrl8WqUhYN2rWDGOb4' // Replace with your HERE Maps API Key
            });
            const defaultLayers = platform.createDefaultLayers();

            // Map initialization and simulation
            function initializeMapWithMovement() {
                const mapContainer = document.querySelector('.map-container');
                mapContainer.innerHTML = ''; // Clear previous content

                const map = new H.Map(
                    mapContainer,
                    defaultLayers.vector.normal.map,
                    {
                        center: { lat: 37.7749, lng: -122.4194 }, // Initial center
                        zoom: 14,
                        pixelRatio: window.devicePixelRatio || 1
                    }
                );

                // Enable map interactions
                const behavior = new H.mapevents.Behavior(new H.mapevents.MapEvents(map));
                const ui = H.ui.UI.createDefault(map, defaultLayers);

                // Define the bus route (mock data)
                const busRoute = [
                    { lat: -0.062916, lng: 34.775758 },
                    { lat: -0.062916, lng: 34.775758 },
                    { lat: -0.062354, lng: 34.775873 },
                    { lat: -0.062354, lng: 34.775873 },
                    { lat: -0.062354, lng: 34.775873 },
                    { lat: -0.061961, lng: 34.775924 },
                    { lat: -0.061961, lng: 34.775924 },
                    { lat: -0.061961, lng: 34.775924 },
                    { lat: -0.061459, lng: 34.775944 },
                    { lat: -0.061459, lng: 34.775944 },
                    { lat: -0.061459, lng: 34.775944 },
                    { lat: -0.060811, lng: 34.776007 },
                    { lat: -0.060811, lng: 34.776007 },
                    { lat: -0.060174, lng: 34.776071 },
                    { lat: -0.060174, lng: 34.776071 },
                    { lat: -0.059595, lng: 34.776156 },
                    { lat: -0.059595, lng: 34.776156 },
                    { lat: -0.059013, lng: 34.776150 },
                    { lat: -0.059013, lng: 34.776150 },
                    { lat: -0.058346, lng: 34.776151 },
                    { lat: -0.058346, lng: 34.776151 },
                    { lat: -0.057952, lng: 34.776063 },
                    { lat: -0.057952, lng: 34.776063 },
                    { lat: -0.057420, lng: 34.775795 },
                    { lat: -0.057420, lng: 34.775795 },
                    { lat: -0.056899, lng: 34.774986 },
                    { lat: -0.056899, lng: 34.774986 },
                    { lat: -0.056601, lng: 34.774790 },
                    { lat: -0.056601, lng: 34.774790 },
                    { lat: -0.056134, lng: 34.774407 },
                    { lat: -0.056134, lng: 34.774407 },
                    { lat: -0.055702, lng: 34.774090 },
                    { lat: -0.055702, lng: 34.774090 },
                    { lat: -0.055702, lng: 34.774090 },
                    { lat: -0.055295, lng: 34.773824 },
                    { lat: -0.054983, lng: 34.773620 },
                    { lat: -0.054983, lng: 34.773620 },
                    { lat: -0.054563, lng: 34.773360 },
                    { lat: -0.054563, lng: 34.773360 },
                    { lat: -0.054069, lng: 34.773062 },
                    { lat: -0.054069, lng: 34.773062 },
                    { lat: -0.053577, lng: 34.772679 },
                    { lat: -0.053577, lng: 34.772679 },
                    { lat: -0.053050, lng: 34.772477 },
                    { lat: -0.053050, lng: 34.772477 },
                    { lat: -0.052425, lng: 34.772309 },
                    { lat: -0.052425, lng: 34.772309 },
                    { lat: -0.051896, lng: 34.772190 },
                    { lat: -0.051896, lng: 34.772190 },
                    { lat: -0.051445, lng: 34.771989 },
                    { lat: -0.051445, lng: 34.771989 },
                    { lat: -0.051104, lng: 34.771747 },
                    { lat: -0.051104, lng: 34.771747 },
                    { lat: -0.050692, lng: 34.771295 },
                    { lat: -0.050692, lng: 34.771295 },
                    { lat: -0.050452, lng: 34.771017 },
                    { lat: -0.050452, lng: 34.771017 },
                    { lat: -0.050177, lng: 34.770665 },
                    { lat: -0.050177, lng: 34.770665 }
                ];

                // Add a marker for the bus
                const marker = new H.map.Marker(busRoute[0]);
                map.addObject(marker);

                // Function to simulate movement along the route
                let index = 0;
                function moveBus() {
                    if (index < busRoute.length) {
                        if (index === 0) {
                            showCustomAlert("The student's journey has begun!");
                        } else if (index === busRoute.length - 1) {
                            showCustomAlert("The student's journey has ended!");
                        }
                        const position = busRoute[index];
                        marker.setGeometry(position); // Update marker position
                        map.setCenter(position); // Center the map on the marker
                        index++;
                        setTimeout(moveBus, 1000); // Adjust interval for speed
                    }
                }

                moveBus(); // Start movement simulation

                // Resize map on window resize
                window.addEventListener('resize', () => map.getViewPort().resize());
            }

            // Initialize the map when the page loads
            document.addEventListener('DOMContentLoaded', initializeMapWithMovement);
        </script>
    </div>
</div>
</body>
</html>
{{ end }}